<div class="p-12">
  <div class="mx-auto flex flex-col max-w-7xl gap-4">
    <h1 class="text-4xl font-semibold mb-8">Neue Studie erstellen</h1>
    <form class="flex flex-col gap-4" [formGroup]="formGroup">
      <label class="form-control">
        <span class="label">Name</span>
        <input
          type="text"
          class="input input-bordered"
          [formControl]="formGroup.controls.name"
        />
      </label>
      <label class="form-control">
        <span class="label">Beschreibung</span>
        <textarea
          class="textarea textarea-bordered"
          [formControl]="formGroup.controls.description"
        ></textarea>
      </label>
      <div class="divider"></div>
      <div class="flex flex-col gap-10" formArrayName="tasks">
        <div
          *ngFor="let task of taskControls; let i = index"
          [formGroup]="task"
          class="indicator w-full"
          data-testid="task-wrapper"
        >
          <div class="indicator-item indicator-top">
            <button
              class="btn btn-error btn-circle btn-sm"
              (click)="deleteTask(i)"
              data-testid="delete-task-button"
            >
              <ng-icon name="heroTrash" aria-label="Aufgabe löschen" />
            </button>
          </div>

          <div
            class="border p-4 rounded-lg w-full flex flex-col gap-4"
            [ngClass]="{
              'border-error': task.invalid && task.touched
            }"
          >
            <label class="form-control">
              <span class="label">Aufgabentyp</span>
              <select
                class="select select-bordered ng-invalid:select-error"
                [formControl]="task.controls.assignmentId"
              >
                <option [value]="null" disabled selected>
                  Aufgabentyp auswählen
                </option>
                <option
                  *ngFor="let assignment of assignments"
                  [value]="assignment.id"
                >
                  {{ assignment.name }}
                </option>
              </select>
              <span
                class="text-error"
                *ngIf="
                  task.controls.assignmentId.touched &&
                  task.controls.assignmentId.invalid
                "
              >
                {{ task.controls.assignmentId.errors?.['required'] && "Bitte Aufgabentypen auswählen" }}
              </span>
            </label>
            <stochus-assignment-config-form-host
              *ngIf="task.controls.assignmentId.value !== null"
              [assignmentId]="task.controls.assignmentId.value!"
              [configFormControl]="task.controls.config!"
            />
          </div>
        </div>
        <button
          class="btn btn-outline btn-info"
          (click)="addTask()"
          data-testid="add-task-button"
        >
          + Neue Aufgabe hinzufügen
        </button>
      </div>
      <input
        type="submit"
        data-testid="submit-button"
        value="Speichern"
        class="btn btn-primary"
        [disabled]="formGroup.invalid"
      />
    </form>
  </div>
</div>
